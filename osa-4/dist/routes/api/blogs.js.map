{"version":3,"sources":["../../../src/routes/api/blogs.js"],"names":["router","Router","get","request","response","blogs","find","populate","username","isAdult","json","err","console","log","post","user","findById","id","blog","body","validate","status","message","concat","save","savedBlog","delete","params","toString","remove","put","findByIdAndUpdate","new"],"mappings":"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","file":"blogs.js","sourcesContent":["import express from 'express';\nimport asyncHandler from 'express-async-handler';\nimport Blog from '../../models/blog';\nimport User from '../../models/user';\n\nexport default () => {\n\tconst router = express.Router();\n\n\trouter.get('/', asyncHandler(async(request, response) => {\n\t\ttry {\n\t\t\tconst blogs = await Blog.find({}).populate('user', {username: 1, isAdult: 1});\n\t\t\tresponse.json(blogs);\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t}\n\t}));\n\n\trouter.post('/', asyncHandler(async(request, response) => {\n\t\tconst user = await User.findById(request.user.id);\n\t\tconst blog = new Blog({...request.body, user: user.id});\n\n\t\ttry {\n\t\t\tawait blog.validate();\n\t\t} catch (err) {\n\t\t\tthrow {status: 400, message: 'Bad Request'};\n\t\t}\n\n\t\tuser.blogs = user.blogs.concat(blog.id);\n\t\tawait user.save();\n\n\t\tconst savedBlog = await blog.save();\n\t\tresponse.status(201).json(savedBlog);\n\t}));\n\n\trouter.delete('/:id', asyncHandler(async(request, response) => {\n\t\tconst {id} = request.params;\n\n\t\tlet blog;\n\t\ttry {\n\t\t\tblog = await Blog.findById(id);\n\t\t} catch (err) {\n\t\t\tthrow {status: 400, message: 'Invalid id'};\n\t\t}\n\n\t\tif (blog) {\n\t\t\tif (blog.user.toString() !== request.user.id) {\n\t\t\t\tthrow {status: 401, message: 'Cannot delete someone else\\'s blog'};\n\t\t\t}\n\n\t\t\tawait blog.remove();\n\t\t}\n\n\t\tresponse.status(204).json({message: 'deleted'});\n\t}));\n\n\trouter.put('/:id', asyncHandler(async(request, response) => {\n\t\tconst {id} = request.params;\n\t\tlet blog;\n\n\t\ttry {\n\t\t\tblog = await Blog.findByIdAndUpdate(id, request.body, {new: true});\n\t\t} catch (err) {\n\t\t\tthrow {status: 400, message: 'Invalid id'};\n\t\t}\n\n\t\tif (!blog) {\n\t\t\tthrow {status: 404, message: `Resource with id ${id} not found`};\n\t\t}\n\n\t\tresponse.status(201).json(blog);\n\t}));\n\n\treturn router;\n};\n"]}